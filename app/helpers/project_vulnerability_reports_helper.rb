module ProjectVulnerabilityReportsHelper
  def format_pvs(pvr)
    score = pvr.vulnerability_score.to_f.round
    number_to_human(score, precision: 2, units: { thousand: 'K' }, format: '%n%u')
  end

  def format_pss(pvr)
    number_to_percentage(pvr.security_score, precision: 0)
  end

  def pointer(pvr, pvs = false)
    extra_css = ''
    if pvs
      score = pvr.vulnerability_score.to_f
      @max_score ||= ProjectVulnerabilityReport.max_score
      percentage = ((score / @max_score.to_f) * 84).round
    else
      score = pvr.security_score.to_f
      percentage = (score * 84) / 100
      extra_css = ';width: 32px;' if score >= 100
    end
    number_to_percentage(percentage, precision: 0) + extra_css
  end

  def pss_content(pvr)
    number_to_percentage(pvr.security_score.to_f, precision: 2, strip_insignificant_zeros: true)
  end

  def pvs_content(pvr)
    @max_rank ||= ProjectVulnerabilityReport.max_rank
    score = pvr.vulnerability_score.to_f.round(2)
    rank = pvr.current_rank.ordinalize
    I18n.t('projects.show.vulnerability_report.pvs_tooltip', score: score, rank: rank, max_rank: @max_rank)
  end
end
