class Vulnerability < ActiveRecord::Base
  enum severity: [:low, :medium, :high]

  has_and_belongs_to_many :releases, counter_cache: true

  scope :sort_by_cve_id, -> (order = :desc) { order(cve_id: order) }

  DESC_LENGTH = 150

  def recent_releases
    releases = self.releases.order(released_on: :desc).first(10)
    releases.map(&:version).join(', ') unless releases.empty?
  end

  def self.severity_exists?(name)
    severities.keys.include? name
  end

  def years_ago?(year = 1)
    published_on.to_date <= year.to_i.years.ago.to_date
  end
end
